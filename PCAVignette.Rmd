---
title: "PCAVignette"
author: "Gabrielle Bueno"
date: "5/15/2021"
output: html_document
---

Libraries
```{r}
library(ggplot2)
library(readr)
library(plotly)
library(dplyr)
library(factoextra)
```

Read in correctly
```{r}
StudentScores <- read_csv("~/Desktop/StudentScores.csv")
StudentScores
StudentScoresTest <- read_csv("~/Desktop/StudentScoresAA.csv")
```

```{r}
stripchart(StudentScores$AlgebraScore, xlab = "Algebra Scores")
text(StudentScores$AlgebraScore, 1.1, labels = StudentScores$Student)
```


```{r}
fig2D <- ggplot(data = StudentScores, aes(x = AlgebraScore, y = StatisticsScore)) + geom_point() +
  geom_text(label = rownames(StudentScores), nudge_x = 1, nudge_y = 1)
fig2D
```

```{r}
fig3D <- plot_ly(data = StudentScores, x = StudentScores$AlgebraScore, y = StudentScores$StatisticsScore, 
                 z = StudentScores$ReadingScore, type = "scatter3d", mode = "markers+text", color = ~StudentScores$Student)
fig3D1 <- fig3D %>% layout(
  scene = list(
    xaxis = list(title = "Algebra Score"), 
    yaxis = list(title = "Statistics Score"),
    zaxis = list(title = "Reading Score")))
fig3D1
```

```{r}
fig2D1 <- fig2D + xlab("Variable 1: Algebra Scores") + ylab("Variable 2: Statistics Scores")
fig2D1
```

```{r}
avgAlgebra <- mean(StudentScores$AlgebraScore)
avgStats <- mean(StudentScores$StatisticsScore)
fig2D1 + annotate("text", x = 73.4, y = 45, label = "X", colour = "blue", size = 10) +
  annotate("text", x = 45, y = 72.6, label = "X", colour = "red", size = 10) +
  annotate("text", x = 73.4, y = 72.6, label = "X", colour = "green", size = 15)
```

I made the math scores highly correlated, and the english scores highly correlated. As you can see here, in PC2 the english scores are pulling a lot of weight, and in PC4 the math scores are pulling a lot of weight. 

The first principal component is the one that's most strongly correlated with the most original variables. PC1 increases with both reading and poetry scores, which means that those two are correlated--as reading score increases, so does poetry score. PC2 decreases with both algebra and stats scores, which means again that those two are strongly correlated--as a student's algebra score decreases, so does their statistics score.  

If you look at PC2 and PC4, you can see that english scores are most correlated with PC2, and math scores are most correlated with PC4. So PC2 is a better measurement of just english scores, and PC4 of just math scores. 
```{r}
StudentScore <- select(StudentScores, -all_of("Student")) #removing "Student" as a column, because otherwise the ID number will be calculated into the PCA
rownames(StudentScore) <- paste("", 1:10)
pcaStudents <- prcomp(StudentScore, scale = TRUE)
pcaStudents
```

```{r}
plot(pcaStudents$x[,1], pcaStudents$x[,2], xlab = "PC1", ylab = "PC2")
```
```{r}
pcaVariation <- pcaStudents$sdev^2
pcaVarPercent <- round(pcaVariation/sum(pcaVariation)*100, 1)
barplot(pcaVarPercent, xlab = "Principal Component", ylab = "Percentage of Explained Variance")
```

```{r}
res.var <- get_pca_var(pcaStudents)
res.var$contrib
```

```{r}
pcaStudentPlot <- data.frame(Student=rownames(pcaStudents$x), X = pcaStudents$x[,1], Y = pcaStudents$x[,2])
pcaStudentPlot
```
```{r}
ggplot(data = pcaStudentPlot, aes(x = X, y = Y, label = Student)) + geom_text() +
  xlab(paste("PC1 - ", pcaVarPercent[1], "%", sep = "")) + 
  ylab(paste("PC2 - ", pcaVarPercent[2], "%", sep = "")) + 
  theme_bw() + ggtitle("Students' Scores PCA Graph") 
```

Loading scores
```{r}
StudentLoadingScores <- pcaStudents$rotation[,1]
TestScores <- abs(StudentLoadingScores) #Absolute values, bc there are negative and postiive values
TestScoresRanked <- sort(TestScores, decreasing = TRUE) #Sort by magnitude
ScoresByRank <- names(TestScoresRanked)
pcaStudents$rotation[ScoresByRank,1] #Puts the negatives and positives back in
```





I'm at 5:44